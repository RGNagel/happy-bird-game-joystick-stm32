/*
 * happy_bird.h
 *
 *  Created on: 4 de jun de 2019
 *      Author: rgnagel
 */

#ifndef HAPPY_BIRD_H_
#define HAPPY_BIRD_H_

#include "PRNG_LFSR.h"

#define true 1
#define TRUE 1
#define false 0
#define FALSE 0

#define MAX_X 83
#define MAX_Y 47
#define UPPER_BOUND 2200
#define LOWER_BOUND 1800

/*
 * all bitmap pictures must be 48x84 (width x height) or less
 * if escreve2fb() is used the picture must be 48x84 or bigger
 * i.e. the converted vector must contain 504 elements or more
 */

// 25 x 18 (width x height)
const struct figura_t hb_bird_fig = {
		.largura = 25,
		.altura = 18,
		.pixels = {
				0x80, 0x60, 0x20, 0x20, 0x20, 0x38, 0x24, 0x64, 0xC6, 0x03, 0x01, 0x01, 0x01, 0xF9, 0x9D, 0x0F,
				0x07, 0x46, 0xE6, 0x4C, 0x18, 0xF0, 0x00, 0x00, 0x00, 0x03, 0x04, 0x08, 0x10, 0x10, 0x10, 0x70,
				0x98, 0x8F, 0x80, 0x00, 0x00, 0x00, 0x10, 0x01, 0x4B, 0x92, 0x92, 0x92, 0x92, 0x92, 0x93, 0xF2,
				0x12, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		}
};
const struct figura_t hb_black_little_bird_fig = {
		.largura = 11,
		.altura = 11,
		.pixels = {
				0x70, 0xFC, 0xFE, 0xFE, 0xFF, 0x77, 0x5F, 0x56, 0xDE, 0xDC, 0x50, 0x00, 0x01, 0x03, 0x03
		}
};

struct pontos_t hb_bird_pts;

const struct figura_t hb_obstacle_fig = {
		.largura = 10,
		.altura = 47,
		.pixels = {
				0x84, 0xCE, 0xFF, 0xCE, 0x84, 0x84, 0xCE, 0xFF, 0xCE, 0x84, 0x10, 0x39, 0xFF, 0x39, 0x10, 0x10,
				0x39, 0xFF, 0x39, 0x10, 0x42, 0xE7, 0xFF, 0xE7, 0x42, 0x42, 0xE7, 0xFF, 0xE7, 0x42, 0x08, 0x9C,
				0xFF, 0x9C, 0x08, 0x08, 0x9C, 0xFF, 0x9C, 0x08, 0x21, 0x73, 0xFF, 0x73, 0x21, 0x21, 0x73, 0xFF,
				0x73, 0x21, 0x04, 0x4E, 0x7F, 0x4E, 0x04, 0x04, 0x4E, 0x7F,
		}
};
struct pontos_t hb_obstacle_pts;

const unsigned char hb_opening [] = {
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0x3F,
		0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F,
		0x3F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xC1, 0xC1, 0xC1, 0xC1, 0xC1, 0x01, 0x01,
		0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0xFC, 0xFC, 0xFC, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xC1, 0xC1, 0xC1, 0xC1, 0x01, 0x1F, 0x1F, 0x1F, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x0E, 0x0E, 0x0E, 0x00, 0xE0, 0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x00, 0xE0, 0xE0, 0xE0, 0xE0, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x70, 0x70, 0x00, 0x07, 0x07, 0x07, 0x07, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x70,
		0x70, 0x70, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
		0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03,
		0x03, 0x00, 0x38, 0x38, 0x38, 0x38, 0x00, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83,
		0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC,
		0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
};

/* get a random point from which we will draw a empty retangle for the bird to go through */
static inline uint32_t get_initial_y(void)
{
	return prng_LFSR() % (MAX_Y - hb_bird_fig.altura);
}

/* prop: 0: clean, otherwise draw */
void desenha_retangulo_preenchido(struct pontos_t *pts, uint32_t prop)
{
	struct pontos_t line;
	line.y1 = pts->y1;
	line.y2 = pts->y2;

	for (uint32_t dx = pts->x1; dx <= pts->x2; dx++) {
		line.x1 = dx;
		line.x2 = dx;
		desenha_linha(&line, prop);
	}
}

inline void apaga_fig(struct pontos_t *pts, struct figura_t *fig)
{
	struct pontos_t rect;
	rect.x1 = pts->x1;
	rect.y1 = pts->y1;
	if (pts->y2 == 0 || pts->x2 == 0) {
		rect.x2 = pts->x1 + fig->largura;
		rect.y2 = pts->y1 + fig->altura;
	}
	else {
		rect.x2 = pts->x2;
		rect.y2 = pts->y2;
	}
	desenha_retangulo_preenchido(&rect, 0);
}

#endif /* HAPPY_BIRD_H_ */
